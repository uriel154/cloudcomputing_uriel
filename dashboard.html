<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - Mi Clase en la Nube</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <h1>Panel de Datos</h1>
  <button onclick="logout()">Cerrar sesión</button>

  <div>
    <input type="text" id="new-item" placeholder="Nuevo dato..." />
    <button onclick="addItem()">Agregar</button>
  </div>

  <ul id="items-list"></ul>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = "TU_URL_SUPABASE";
    const supabaseKey = "TU_KEY_SUPABASE";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function checkSession() {
      const { data } = await supabase.auth.getSession();
      if (!data.session) {
        window.location.href = "/index.html";
      } else {
        loadItems();
      }
    }

    async function logout() {
      await supabase.auth.signOut();
      window.location.href = "/index.html";
    }

    async function loadItems() {
      const { data, error } = await supabase.from('items').select('*');
      if (error) {
        console.error(error);
        return;
      }
      const list = document.getElementById('items-list');
      list.innerHTML = '';
      data.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `
          ${item.name} 
          <button onclick="editItem(${item.id}, '${item.name}')">Editar</button>
          <button onclick="deleteItem(${item.id})">Eliminar</button>
        `;
        list.appendChild(li);
      });
    }

    async function addItem() {
      const name = document.getElementById('new-item').value;
      if (!name.trim()) return;
      const { error } = await supabase.from('items').insert([{ name }]);
      if (error) alert(error.message);
      else {
        document.getElementById('new-item').value = '';
        loadItems();
      }
    }

    async function editItem(id, currentName) {
      const newName = prompt("Editar nombre:", currentName);
      if (newName && newName !== currentName) {
        const { error } = await supabase.from('items').update({ name: newName }).eq('id', id);
        if (error) alert(error.message);
        else loadItems();
      }
    }

    async function deleteItem(id) {
      if (confirm("¿Seguro que quieres eliminar este elemento?")) {
        const { error } = await supabase.from('items').delete().eq('id', id);
        if (error) alert(error.message);
        else loadItems();
      }
    }

    checkSession();
  </script>
</body>
</html>
